"use strict";showLoading(),Zepto(function(e){function t(){return"请选择"!=e("#timeDate").text()&&("请选择"!=e("#goodstype").text()&&(""!=e(".goodsweightNum").val()&&(!!e("#defaultCheckBox").hasClass("defaultSelect")&&(e(".single_btn").removeClass("disabled"),!0))))}BizLog.call("info",{seedId:"a106.b12.c01.d01",actionId:"openPage"}),FastClick.attach(document.body);var i,a,s,o,n,l,r,d,c,m,g=!0,u=[],h=!0;e("#text-content").focus(function(){BizLog.call("info",{seedId:"a106.b12.c03.d05",actionId:"clicked"}),setTimeout(function(){f=!0,console.log("#text6666 "+f)},600),this.style.color="#000","其他要求请在此备注(选填)"==this.value&&(this.value="")}),e("#text-content").blur(function(){""==this.value&&(this.value="其他要求请在此备注(选填)",this.style.color="#ccc")}),ant.on("resume",function(t){h=!0,e(".single_btn").removeClass("loading"),e(".single_btn").html("立即下单")}),function(){t();var g=getUrlParam("id"),h=(getUrlParam("snderDstrCode"),getUrlParam("rcvrDstrCode"),{snderDstrCode:"110105",rcvrDstrCode:"110105",id:g});e.axs("https://sendex.alipay-eco.com/api/ep/test/order/index",h,function(t){if(t.meta.success){var g=t.result,h="";if(g&&""!=g){var v=g.servicingText,f=g.goodsTypes,b=g.times,y=g.addServices;d=JSON.parse(g.goodsMaxWeight),a=g.productTypes,i=g.productTypes[0].productTypeId,s=parseFloat(g.productTypes[0].presetWeight),o=parseFloat(g.productTypes[0].presetWeightPrice),n=parseFloat(g.productTypes[0].extraWeightUnit),l=parseFloat(g.productTypes[0].extraWeightPrice),r=g.productTypes[0].description,c=g.productTypes[0].discount,m=g.productTypes[0].productTypeCode,p.initExpressType(a),e("#expressId").html(a[0].productTypeName),e(".priceNum").html("首重"+o/100+"元，续重"+l/100+"元"),e(".goodsweightNum").val(s/1e3),p.initWeightData(),e("#goodstype").text(f[0]);for(var x in b){var S="TDY"==x?"今天":"TOM"==x?"明天":"后天",I=b[x][0];e("#timeDate").html(JSON.parse(JSON.stringify(S+"<span style='padding-left:.05rem;'></span>"+I))),e(".day1").val(JSON.parse(JSON.stringify(S))),e(".time1").val(JSON.parse(JSON.stringify(I)));break}e("#goodsweight").html(u[0]),e(".estimatePrice-data").html((o/100).toFixed(2)),y&&""!=y?(e(".extra_service_show").show(),e(".extra_service_txt").show(),e(".extra_service").css("padding-bottom","0.05rem"),e(".kd-info-text").css({"background-color":"#f5f5f9"})):(e(".extra_service_show").hide(),e(".extra_service_txt").hide(),e(".extra_service").css("padding-bottom","0"),e(".kd-info-text").css({"background-color":"#f5f5f9","border-bottom":"0"})),p.initselectDateEvent(b),p.initSelectTypeEvent(f),p.initSelectWeightEvent(u,o,s,n,l),p.initselectExpressType(),e(".timeText").text(v),e.each(y,function(e){h+='<div class="" style="min-width:0rem;text-align:center;width: 1.46rem;margin: 0.15rem 0rem 0.1rem 0.25rem;border: 1px #108ee9 dotted;padding: 0.02rem 0.02rem;line-height: .24rem;margin-top:0rem;">'+y[e]+"</div>"}),e(".extra_service").html(h),e(".extra_service div").click(function(){BizLog.call("info",{seedId:"a106.b12.c03.d04",actionId:"clicked"}),e(this).toggleClass("express_active")})}hideLoading()}},function(e){toast({text:e.meta.msg,type:"exception"})})}(),e(".dialog-close-num").click(function(){BizLog.call("info",{seedId:"a106.b16.c02.d02",actionId:"clicked"}),e(".dialog-num").hide(),h=!0,e(".single_btn").removeClass("loading"),e(".single_btn").html("立即下单")}),e("#btn-kefu").click(function(){BizLog.call("info",{seedId:"a106.b16.c02.d03",actionId:"clicked"})}),e("#btn-sumbit").click(function(){BizLog.call("info",{seedId:"a106.b16.c02.d04",actionId:"clicked"}),e(".dialog-num").hide(),h=!0,e(".single_btn").removeClass("loading"),e(".single_btn").html("立即下单")});var p=new Object({initWeightData:function(){u=[];var e=Math.round((d-s)/n)+1;console.log(e);for(var t=0;t<e;t++){var i=(s+t*n)/1e3;i+=0==t?" 公斤及以下":t==e-1?" 公斤及以上":" 公斤",u.push(i)}},initExpressType:function(t){var i="";t.map(function(e,t){var a=e.description,s="";"-"!=a&&""!=a||(s="displayNone"),i+='<div  class=" am-list twoline" data-select="0" style="width:100%;padding:0;margin-bottom:.1rem"><div class="am-list-item expressType_border" style="background-size:0;border-radius:.05rem;padding-top:.15rem;min-height:0;padding-bottom:.135rem"><div class="am-list-thumb" data-select="1" style="width:.21rem;height:.21rem;background-size:contain;background-image: url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/noselect.png);background-repeat: no-repeat;"></div><div class="am-list-content" style="margin-left:.05rem"><div class="am-list-title am-flexbox twocolumn" style="margin-bottom:0;line-height:1"><label class="am-flexbox-item" style="color:#000;font-size:.24rem;line-height:.24rem">'+e.productTypeName+'</label><div class="am-list-right-brief" style="color:#f4333c;font-size:.14rem;line-height:.24rem;"><span>'+e.presetWeightPrice/100+'</span><span> 元起</span></div></div><div class="am-list-brief '+s+'"style="white-space:normal;font-size:.14rem;line-height:.2rem;margin-top:0.05rem;margin-bottom:-0.02rem;">'+a+"</div></div></div></div>"}),e(".iosselect-box").html(i)},initselectExpressType:function(){var t=this,d=e(".alertInfo").find(".am-list-item").eq(2),p=e("#expressId").html();d.click(function(){BizLog.call("info",{seedId:"a106.b12.c03.d06",actionId:"clicked"}),h&&(e(".myPop").show(),e("body").on("touchmove",function(e){e.preventDefault()},!1),g&&(g=!1,isAndroid&&e(".iosselect-box").find(".am-list-item").css("border","1px solid #ddd"),e(".iosselect-box").find(".am-list-thumb").eq(0).css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/select.png)"}),e(".iosselect-box").find(".am-list").eq(0).attr("data-select","1"),e(".iosselect-box").find(".am-list-item").eq(0).css("border-color","#108ee9"),e(".iosselect-box").find(".am-list:last").css("margin-bottom","0")))}),e(".iosselect-box").find(".am-list").map(function(d,g){e(this).on("click",function(){var d=e(this);"0"==e(this).attr("data-select")&&(d=e(this),e(".iosselect-box").find(".am-list").each(function(){e(this).attr("data-select","0"),e(this).find(".am-list-thumb").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/noselect.png)"}),e(this).find(".am-list-item").css("border-color","#ddd")}),e(this).attr("data-select","1"),e(this).find(".am-list-thumb").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/select.png)"}),e(this).find(".am-list-item").eq(0).css("border-color","#108ee9")),p=d.find("label").html(),e("#expressId").html(p);var g=e(this).index();i=a[g].productTypeId,s=parseFloat(a[g].presetWeight),o=parseFloat(a[g].presetWeightPrice),n=parseFloat(a[g].extraWeightUnit),l=parseFloat(a[g].extraWeightPrice),r=a[g].description,c=parseFloat(a[g].discount),m=a[g].productTypeCode,t.initWeightData(),e(".priceNum").html("首重"+o/100+"元，续重"+l/100+"元"),e("#goodsweight").html(u[0]),e(".estimatePrice-data").html((o/100).toFixed(2)),setTimeout(function(){e(".myPop").hide(),e("body").off("touchmove")},200)})}),e(".myPop").find(".close").click(function(){e(".myPop").hide(),e("body").off("touchmove")}),e(".myPop").find(".sure").click(function(){e(".myPop").hide(),e("body").off("touchmove"),e("#expressId").html(p)})},initselectDateEvent:function(i){console.log(i);var a=document.querySelector("#dateId"),s=document.querySelector("#timeId"),o=e(".alertInfo").find(".am-list-item").eq(0);o.unbind(),o.click(function(){if(BizLog.call("info",{seedId:"a106.b12.c03.d01",actionId:"clicked"}),h){var n=[],l=0,r=[];for(var d in i){var c="TDY"==d?"今天":"TOM"==d?"明天":"后天";n.push({id:l.toString(),value:c,parentId:"0"});for(var m=i[d],g=0;g<m.length;g++)r.push({id:(g+10).toString(),value:m[g],parentId:l.toString()});l++}var u=o.attr("data-date_id"),p=(o.attr("data-date_value"),o.attr("data-time_id")),v=(o.attr("data-time_value"),{title:"",itemHeight:35,headerHeight:42,cssUtil:"px",relation:[1,1,1,1],oneLevelId:u,twoLevelId:p,callback:function(i,n){a.value=i.id,s.value=n.id,o.attr("data-date_id",i.id),o.attr("data-date_value",i.value),o.attr("data-time_id",n.id),o.attr("data-time_value",n.value);e("#timeDate").html(JSON.parse(JSON.stringify(i.value+"<span style='padding-left:.05rem;'></span>"+n.value))),e(".day1").val(JSON.parse(JSON.stringify(i.value))),e(".time1").val(JSON.parse(JSON.stringify(n.value))),ant.setSessionData({data:{dayValue:JSON.parse(JSON.stringify(i.value)),timeValue:JSON.parse(JSON.stringify(n.value)),timeDate:JSON.parse(JSON.stringify(i.value+n.value))}}),t()}}),f=[n,r];new IosSelect(2,f,v)}})},initSelectTypeEvent:function(i){var a=document.querySelector("#typeId"),s=e(".alertInfo").find(".am-list-item").eq(1);s.click(function(){if(BizLog.call("info",{seedId:"a106.b12.c03.d02",actionId:"clicked"}),h){for(var o=s.attr("data-type_id"),n=(s.attr("data-type_value"),[]),l=0;l<i.length;l++)n.push({id:l.toString(),value:i[l]});var r={title:"",itemHeight:35,headerHeight:42,cssUtil:"px",oneLevelId:o,callback:function(i){a.value=i.id,s.attr("data-type_id",i.id),s.attr("data-type_value",i.value),e("#goodstype").text(JSON.parse(JSON.stringify(i.value))),ant.setSessionData({data:{goodstypeValue:JSON.parse(JSON.stringify(i.value))}}),t()}};new IosSelect(1,[n],r)}})},initSelectWeightEvent:function(){var i=document.querySelector("#weightId"),a=e(".alertInfo").find(".am-list-item").eq(3);a.click(function(){if(BizLog.call("info",{seedId:"a106.b12.c03.d03",actionId:"clicked"}),h){for(var r=a.attr("data-weight_id"),d=(a.attr("data-weight_value"),[]),c=0;c<u.length;c++)d.push({id:c.toString(),value:u[c]});var m={title:"",itemHeight:35,headerHeight:42,cssUtil:"px",oneLevelId:r,callback:function(r){if(i.value=r.id,a.attr("data-weight_id",r.id),a.attr("data-weight_value",r.value),""==r.id){var d=1e3*(m=/^[0-9\.]+/g).exec(u[0]),c=o+Math.ceil((d-s)/n)*l;c/=1e3,e(".estimatePrice-data").html(c.toFixed(2))}else{e("#goodsweight").text(JSON.parse(JSON.stringify(r.value)));var m=/^[0-9\.]+/g,g=m.exec(r.value),c=o+Math.ceil((1e3*g-s)/n)*l;c/=100,console.log("weight: "+g),console.log("presetWeightPricePec :"+o),console.log("Math.ceil((weight * 1000 - presetWeight) / extraWeightUnitPec): "+Math.ceil((1e3*g-s)/n)),e(".goodsweightNum").val(g),e(".estimatePrice-data").html(c.toFixed(2)),ant.setSessionData({data:{goodsOneValue:JSON.parse(JSON.stringify(r.value)),goodsOneIndex:JSON.parse(JSON.stringify(r.value))}})}t()}};new IosSelect(1,[d],m)}})}}),v=!1,f=!1;e("#text-content").bind("compositionstart",function(){console.log(" into compositionstart"),v=!0}),e("#text-content").bind("compositionend",function(){console.log(" into compositionend");var t=emojione.toShort(e(this).val());if(e(this).val(t.replace(/\:[a-z0-9_]+\:/g,"")),e(this).val().length>=51){var i=e(this).val().slice(0,50);e(this).val(i),e(".am-toast").show(),setTimeout(function(){e(".am-toast").hide()},800)}v=!1}),e("#text-content").bind("input",function(){if(console.log("into input"+v),!v){var t=emojione.toShort(e(this).val());if(e(this).val(t.replace(/\:[a-z0-9_]+\:/g,"")),e(this).val().length>=51){var i=e(this).val().slice(0,50);e(this).val(i),e(".am-toast").show(),setTimeout(function(){e(".am-toast").hide()},800)}}}),e("#text-content").bind("blur",function(){f=!1}),isAndroid&&e(window).on("scroll",function(t){console.log(f),f&&(console.log("dasdfa"),e("#text-content").blur())},!1),e("#defaultCheckBox").find("span").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/default-select.png)"}),e("#defaultCheckBox").click(function(){BizLog.call("info",{seedId:"a106.b12.c04.d02",actionId:"clicked"}),e(this).hasClass("defaultSelect")?(e(this).toggleClass("defaultSelect"),e(".single_btn").addClass("disabled"),e(this).find("span").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/default-noSelect.png)"})):(e(this).toggleClass("defaultSelect"),t()&&e(".single_btn").removeClass("disabled"),e(this).find("span").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/default-select.png)"}))}),e(".single_btn").click(function(){if(BizLog.call("info",{seedId:"a106.b12.c04.d04",actionId:"clicked"}),console.log("enableButton "+h),h){if(e(this).hasClass("disabled"))return;h=!1,e(this).addClass("loading"),e(this).attr("role","alert"),e(this).attr("aria-live","assertive"),e(this).html('<i class="icon" aria-hidden="true"></i>加载中...'),setTimeout(function(){h=!0,e(".single_btn").removeClass("loading"),e(".single_btn").html("立即下单")},7e3),function(){var a=[],s=e(".extra_service div");if(console.log("vclassArr.length: "+s.length),s&&0!=s.length){for(var o=0;o<s.length;o++)e(s[o]).hasClass("express_active")&&a.push(e(s[o]).text());a=a.join(",")}else a="1";console.log(a);var n=emojione.toShort(e("#text-content").val()).replace(/\:[a-z0-9_]+\:/g,"");if("其他要求请在此备注(选填)"==n&&(n=""),ant.setSessionData({data:{addServiceArr:a,remarkContent:n}}),t()){console.log("productTypeCode"+m);var l={logisMerchLog:"",senderAddrID:15,reciptiensAddrID:7,productTypeCode:m,discount:JSON.parse(c),logisMerchId:2,productId:JSON.parse(i),snderName:e(".data-senderName").html(),snderMobile:e(".data-senderNumber").html(),snderPrvnCode:"110000",snderCityCode:"110100",snderDstrCode:"110105",snderStreet:"",snderAddress:e(".data-street").text(),rcvrName:e(".data-recipientsName").html(),rcvrMobile:e(".data-recipientsNumber").html(),rcvrPrvnCode:"110000",rcvrCityCode:"110100",rcvrDstrCode:"110105",rcvrStreet:"",rcvrAddress:e(".data-restreet").text(),bookedDay:"今天"==e(".day1").val()?"TDY":"明天"==e(".day1").val()?"TOM":"AFT",bookedTime:e(".time1").val(),goodsType:e("#goodstype").text(),goodsWeight:1e3*e(".goodsweightNum").val(),remark:n,addService:a,estimatePrice:100*JSON.parse(e(".estimatePrice-data").text())},r=jUrl+"/ep/order/save";isNetworkAvailable||(h=!0,e(".single_btn").removeClass("loading"),e(".single_btn").html("立即下单")),e.axs(r,l,function(t){if(e(".single_btn").removeClass("loading"),e(".single_btn").html("立即下单"),"0000"==t.meta.code){if((t=t.result.orderNo)&&""!=t)var i=t;pushWindow("scuess-order.html?orderNo="+i,!1)}else ant.pushWindow({url:"single-failure.html"})},function(t){if(h=!0,e(".single_btn").removeClass("loading"),e(".single_btn").html("立即下单"),"1820"==t.meta.code)h=!0,e(".single_btn").removeClass("loading"),e(".single_btn").html("立即下单"),setTimeout(function(){notPaidOrder(t.result.notPaidOrderNo,t.result.notPaidRemindCnt)},10);else if("1810"==t.meta.code)toast({text:"预约取件时间无效",type:"exception"});else if("1812"==t.meta.code)h=!0,e(".single_btn").removeClass("disabled"),BizLog.call("info",{seedId:"a106.b16.c02.d01",actionId:"openPage"}),e(".dialog-num").show();else if("1813"==t.meta.code)toast({text:"快递公司下单失败",type:"exception"});else if("1817"==t.meta.code){var i=t.result.times;p.initselectDateEvent(i);for(var a in i){var s="TDY"==a?"今天":"TOM"==a?"明天":"后天",o=i[a][0];e("#timeDate").html(JSON.parse(JSON.stringify(s+"<span style='padding-left:.05rem;'></span>"+o))),e(".day1").val(JSON.parse(JSON.stringify(s))),e(".time1").val(JSON.parse(JSON.stringify(o)));break}toast({text:"请重新确认上门时间"})}else toast({text:"创建订单失败，请重试",type:"exception"})})}}()}}),e(".price_rule").on("click",function(){BizLog.call("info",{seedId:"a106.b12.c04.d01",actionId:"clicked"}),e("#text-content").blur(),setTimeout(function(){ant.pushWindow({url:"price-rule.html"})},300)}),e(".service_agreement").on("click",function(){BizLog.call("info",{seedId:"a106.b12.c04.d03",actionId:"clicked"}),e("#text-content").blur(),setTimeout(function(){ant.pushWindow({url:"service-agreement.html"})},300)})});