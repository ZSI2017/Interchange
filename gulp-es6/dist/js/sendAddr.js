"use strict";Zepto(function(e){FastClick.attach(document.body),console.log("edit"==getUrlParam("edit"));var t=getUrlParam("edit"),a="",d="",i="",n="",o="",s="",c="",r="";"edit"==t?("a106.b2104",a="a106.b2104.c4601.d7120",d="a106.b2104.c4601.d7121",i="a106.b2104.c4601.d7122",n="a106.b2104.c4601.d7124",s="a106.b2104.c4600.d7119",e("body").attr("data-aspm","b2104"),e(".sender_name").attr("data-spmv",a),e(".sender_phone").attr("data-spmv",d),e(".sender_address").attr("data-spmv",i),e(".sender_dizhi").attr("data-spmv",n),e(".am-button").attr("data-spmv",s),ant.getSessionData({keys:["edit_senderAddrID"]},function(e){r=e.data.edit_senderAddrID}),ant.call("setTitle",{title:"编辑寄件人地址"})):"write"==t?("a106.b2102",a="a106.b2102.c4593.d7100",d="a106.b2102.c4593.d7101",i="a106.b2102.c4593.d7102",n="a106.b2102.c4593.d7104",o="a106.b2102.c4593.d7105",s="a106.b2102.c4594.d7106",e("body").attr("data-aspm","b2102"),e(".sender_name").attr("data-spmv",a),e(".sender_phone").attr("data-spmv",d),e(".sender_address").attr("data-spmv",i),e(".sender_dizhi").attr("data-spmv",n),e("#defaultClick").attr("data-spmv",o),e(".am-button").attr("data-spmv",s),ant.call("setTitle",{title:"填写寄件人地址"}),e(".defaultSelect").show()):("a106.b2122",a="a106.b2122.c4681.d7296",d="a106.b2122.c4681.d7297",i="a106.b2122.c4681.d7298",n="a106.b2122.c4681.d7300",s="a106.b2122.c4682.d7301",e("body").attr("data-aspm","b2122"),e(".sender_name").attr("data-spmv",a),e(".sender_phone").attr("data-spmv",d),e(".sender_address").attr("data-spmv",i),e(".sender_dizhi").attr("data-spmv",n),e(".am-button").attr("data-spmv",s),ant.call("setTitle",{title:"添加寄件人地址"})),ant.on("resume",function(t){ant.getSessionData({keys:["autocomplete_address"]},function(t){var a=t.data.autocomplete_address;if(""!==a){var d=emojione.toShort(a);e(".sender_dizhi").val(d.replace(/\:[a-z0-9_]+\:/g,"")),e("textarea[autoHeight]").autoHeight()}})}),ant.setSessionData({data:{autocomplete_address:"",autocomplete_cityName:""}}),e.fn.autoHeight=function(){function t(e){e.style.height="auto",e.scrollTop=0,e.style.height=e.scrollHeight+"px"}this.each(function(){t(this),e(this).on("input",function(){t(this)})})},e("textarea[autoHeight]").autoHeight();var l=!1;e(".sender_name").bind("compositionstart",function(){console.log("compositionstart"),l=!0}),e(".sender_name").bind("compositionend",function(){l=!1}),e(".sender_name").bind("input",function(){if(console.log("sendname  input"+e(this).val()),!l){var t=emojione.toShort(e(this).val());if(/\:[a-z0-9_]+\:/g.test(t)&&(t=t.replace(/\:[a-z0-9_]+\:/g,""),e(this).val(t)),e(this).val().length>=21){var a=e(this).val().slice(0,20);e(this).val(a)}}}),e(".sender_phone").bind("input",function(){var t=e(this).val();t=processPhoneNum(t),e(this).val(t)}),e(".sender_dizhi").bind("click",function(){if(""!==c){var t=e(".sender_dizhi").val();ant.setSessionData({data:{autocomplete_address:t,autocomplete_cityName:c}}),pushWindow("autocomplete.html",!1)}else toast({text:"请先选择地区"})}),e(".sender_name").on("click",function(){"edit"==t?BizLog.call("info",{spmId:a,actionId:"clicked",params:{AddrID:r}}):BizLog.call("info",{spmId:a,actionId:"clicked"})}),e(".sender_phone").on("click",function(){"edit"==t?BizLog.call("info",{spmId:d,actionId:"clicked",params:{AddrID:r}}):BizLog.call("info",{spmId:d,actionId:"clicked"})}),e(".sender_dizhi").on("click",function(){"edit"==t?BizLog.call("info",{spmId:n,actionId:"clicked",params:{AddrID:r}}):BizLog.call("info",{spmId:n,actionId:"clicked"})}),function(){var a=e("#select_contact"),d=e("#show_contact"),n=e("#contact_province_code"),o=e("#contact_city_code"),s=e("#contact_district_code");e(".choise_addressstitle").click(function(){"edit"==t?BizLog.call("info",{spmId:i,actionId:"clicked",params:{AddrID:r}}):BizLog.call("info",{spmId:i,actionId:"clicked"}),e("body").on("touchmove",function(e){e.preventDefault()},!1),e(".sender_name").blur(),e(".sender_phone").blur(),e(".sender_dizhi").blur(),a.find("input").focusin(function(){this.blur()});d.attr("data-city-code"),d.attr("data-city-name");var l=d.attr("data-province-code"),_=d.attr("data-city-code"),m=d.attr("data-district-code");new IosSelect(3,[iosProvinces,iosCitys,iosCountys],{itemHeight:35,headerHeight:42,cssUnit:"px",relation:[1,1,0,0],oneLevelId:l,twoLevelId:_,threeLevelId:m,callback:function(e,t,a){n.val(e.id),n.attr("data-province-name",e.value),s.val(a.id),s.attr("data-district-name",a.value),o.val(t.id),o.attr("data-city-name",t.value),d.attr("data-province-code",e.id),d.attr("data-city-code",t.id),d.attr("data-district-code",a.id);var i=e.value,r=t.value;c=r;var l=a.value;console.log("provinceName "+i+"cityName "+r+"districtName "+l+"selectThreeObj.id "+a.id);var _=subAreaString(i,r,l);d.val(_)}})})}(),"write"==t&&(e("#defaultCheckBox").find("span").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/default-select.png)"}),e("#defaultClick").click(function(){"edit"==t?BizLog.call("info",{spmId:o,actionId:"clicked",params:{AddrID:r}}):BizLog.call("info",{spmId:o,actionId:"clicked"});var a=e("#defaultCheckBox");a.hasClass("defaultSelect")?(a.toggleClass("defaultSelect"),a.find("span").css({"background-image":"url(https://kuaidi-dev.oss-cn-hangzhou.aliyuncs.com/mobile/default-noSelect.png)"})):(a.toggleClass("defaultSelect"),a.find("span").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/default-select.png)"}))}));var _=!1;e(".am-button").click(function(){if("edit"==t?BizLog.call("info",{spmId:s,actionId:"clicked",params:{AddrID:r}}):BizLog.call("info",{spmId:s,actionId:"clicked"}),!_&&function(){if(""==e(".sender_name").val()||0===e(".sender_name").val().trim().length||e(".sender_name").val().length>=21)return toast({text:"姓名不能为空"}),!1;if(""==e(".sender_phone").val()||!isCorrectPhoneNum(e(".sender_phone").val()))return toast({text:"请输入正确的手机号或座机号"}),!1;if(""!=e(".sender_address").val()&&" "!=e(".sender_address").val())return!(""==e(".sender_dizhi").val()||0===e(".sender_dizhi").val().trim().length||e(".sender_dizhi").val().length>=51)||(toast({text:"详细地址不能为空"}),!1);toast({text:"请选择地区"})}()){_=!0;e(".am-button").html('<i class="icon" aria-hidden="true"></i>正在保存...'),setTimeout(function(){_=!1,e(".am-button").html("完成")},8e3);var a=e(".sender_name").attr("data-sendID");if("write"==t){var d=cellPhoneHide(e(".sender_phone").val());if(ant.setSessionData({data:{sendName:nameHide(emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,"")),real_sendName:emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,""),sendNumber:d,real_sendNumber:e(".sender_phone").val(),sendProvinceCode:e("#show_contact").attr("data-province-code"),sendCityCode:e("#show_contact").attr("data-city-code"),sendAreaCode:e("#show_contact").attr("data-district-code"),sendStreet:getAreaNameByCode(e("#show_contact").attr("data-district-code")).replace(/\s/g,""),sendAddress:emojione.toShort(e(".sender_dizhi").val()).replace(/\:[a-z0-9_]+\:/g,"")}}),!e("#defaultCheckBox").hasClass("defaultSelect"))return emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,"")==m&&e(".sender_phone").val()==v&&e("#show_contact").attr("data-district-code")==p&&e(".sender_dizhi").val()==h||ant.setSessionData({data:{senderAddrID:-1}}),void ant.popWindow();if("-1"!=a&&emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,"")==m&&e(".sender_phone").val()==v&&e("#show_contact").attr("data-district-code")==p&&e(".sender_dizhi").val()==h)return ant.popWindow(),void console.log("write  data not change");a=!1}if(a)var i={id:a,name:emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,""),mobile:e(".sender_phone").val(),provinceCode:e("#show_contact").attr("data-province-code"),cityCode:e("#show_contact").attr("data-city-code"),districtCode:e("#show_contact").attr("data-district-code"),street:"",address:emojione.toShort(e(".sender_dizhi").val()).replace(/\:[a-z0-9_]+\:/g,"")},n=jUrl+"/ep/sender/edit";else var i={name:emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,""),mobile:e(".sender_phone").val(),provinceCode:e("#show_contact").attr("data-province-code"),cityCode:e("#show_contact").attr("data-city-code"),districtCode:e("#show_contact").attr("data-district-code"),street:"",address:emojione.toShort(e(".sender_dizhi").val()).replace(/\:[a-z0-9_]+\:/g,"")},n=jUrl+"/ep/sender/add";e.axs(n,i,function(e){if(e.meta.success){if(0==f&&!a||"write"==t)if(f++,ant.setSessionData({data:{senderCount:f}}),1!=f||a||-1!=g){var d=cellPhoneHide(e.result.mobile),i=nameHide(e.result.name),n=getAreaNameByCode(e.result.districtCode).replace(/\s/g,"");ant.setSessionData({data:{senderAddrID:e.result.id,sendName:i,sendNumber:d,real_sendName:e.result.name,real_sendNumber:e.result.mobile,sendProvinceCode:e.result.provinceCode,sendCityCode:e.result.cityCode,sendAreaCode:e.result.districtCode,sendStreet:n,sendAddress:e.result.address}})}else;ant.popWindow()}})}});var m,v,u,p,h,g,f=0;ant.getSessionData({keys:["edit_senderAddrID","edit_sendName","edit_sendNumber","edit_sendAddress","edit_sendProvinceCode","edit_sendCityCode","edit_sendAreaCode","senderCount","senderAddrID"]},function(a){if(g=a.data.senderAddrID,a.data.senderCount&&(f=a.data.senderCount),!a.data.edit_senderAddrID||"edit"!=t&&"write"!=t)AlipayJSBridge.call("showLoading",{text:"正在定位"}),ant.call("getLocation",function(t){if(setTimeout(function(){AlipayJSBridge.call("hideLoading")},300),t.error)toast({text:"无法获取定位信息\n请设置允许app获取定位权限"});else{var a=getAreaNameByCode(t.adcode,!0).split(" ");if(a.length<=2)toast({text:"无法获取定位信息"});else{var d=a[0],i=a[1];c=i;var n=a[2],o=t.adcode.substring(0,2)+"0000",s=t.adcode.substring(0,4)+"00",r=t.adcode;e(".provincial_city").attr("data-province-code",o),e("#contact_province_code").val(o),e(".provincial_city").attr("data-city-code",s),e("#contact_city_code").val(s),e(".provincial_city").attr("data-district-code",r),e("#contact_district_code").val(r);var l=subAreaString(d,i,n);e(".provincial_city").val(l),e("#contact_district_code").attr("data-district-name",n),e("#contact_city_code").attr("data-city-name",i),e("#contact_province_code").attr("data-province-name",d)}}});else{var d=a.data.edit_senderAddrID;m=a.data.edit_sendName||"",v=a.data.edit_sendNumber||"",h=a.data.edit_sendAddress||"";var i=a.data.edit_sendProvinceCode||"",n=a.data.edit_sendCityCode||"";p=a.data.edit_sendAreaCode||"",e(".sender_name").attr("data-sendID",d),e(".sender_name").val(m),e(".sender_phone").val(v),e(".sender_dizhi").val(h),e("textarea[autoHeight]").autoHeight();getUrlParam("sRid"),getUrlParam("selectSUid");for(o=0;o<iosProvinces.length;o++)i==iosProvinces[o].id&&(e("#contact_province_code").val(iosProvinces[o].id),e("#contact_province_code").attr("data-province-name",iosProvinces[o].value));for(o=0;o<iosCitys.length;o++)n==iosCitys[o].id&&(e("#contact_city_code").val(iosCitys[o].id),e("#contact_city_code").attr("data-city-name",iosCitys[o].value));for(var o=0;o<iosCountys.length;o++)p==iosCountys[o].id&&(e("#contact_district_code").val(iosCountys[o].id),e("#contact_district_code").attr("data-district-name",iosCountys[o].value));var s=e("#contact_province_code").attr("data-province-name"),r=e("#contact_city_code").attr("data-city-name");c=r;var l=e("#contact_district_code").attr("data-district-name");u=subAreaString(s,r,l),e(".sender_address").val(u),e(".sender_address").attr("data-province-code",e("#contact_province_code").val()),e(".sender_address").attr("data-city-code",e("#contact_city_code").val()),e(".sender_address").attr("data-district-code",e("#contact_district_code").val())}})});