"use strict";Zepto(function(e){function t(){AlipayJSBridge.call("showLoading",{text:"正在定位"}),ant.call("getLocation",function(t){if(setTimeout(function(){AlipayJSBridge.call("hideLoading")},300),t.error)return void toast({text:"无法获取定位信息\n请设置允许app获取定位权限"});var a=getAreaNameByCode(t.adcode,!0),d=a.split(" ");if(d.length<=2)return void toast({text:"无法获取定位信息"});var i=d[0],n=d[1];l=n;var o=d[2],s=t.adcode.substring(0,2)+"0000",c=t.adcode.substring(0,4)+"00",r=t.adcode;e(".provincial_city").attr("data-province-code",s),e("#contact_province_code").val(s),e(".provincial_city").attr("data-city-code",c),e("#contact_city_code").val(c),e(".provincial_city").attr("data-district-code",r),e("#contact_district_code").val(r);var _=subAreaString(i,n,o);e(".provincial_city").val(_),e("#contact_district_code").attr("data-district-name",o),e("#contact_city_code").attr("data-city-name",n),e("#contact_province_code").attr("data-province-name",i)})}function a(){return""==e(".sender_name").val()||0===e(".sender_name").val().trim().length||e(".sender_name").val().length>=21?(toast({text:"姓名不能为空"}),!1):""!=e(".sender_phone").val()&&isCorrectPhoneNum(e(".sender_phone").val())?""==e(".sender_address").val()||" "==e(".sender_address").val()?void toast({text:"请选择地区"}):!(""==e(".sender_dizhi").val()||0===e(".sender_dizhi").val().trim().length||e(".sender_dizhi").val().length>=51)||(toast({text:"详细地址不能为空"}),!1):(toast({text:"请输入正确的手机号或座机号"}),!1)}FastClick.attach(document.body),console.log("edit"==getUrlParam("edit"));var d=getUrlParam("edit"),i="",n="",o="",s="",c="",r="",l="",_="";"edit"==d?("a106.b2104",i="a106.b2104.c4601.d7120",n="a106.b2104.c4601.d7121",o="a106.b2104.c4601.d7122",s="a106.b2104.c4601.d7124",r="a106.b2104.c4600.d7119",e("body").attr("data-aspm","b2104"),e(".sender_name").attr("data-spmv",i),e(".sender_phone").attr("data-spmv",n),e(".sender_address").attr("data-spmv",o),e(".sender_dizhi").attr("data-spmv",s),e(".am-button").attr("data-spmv",r),ant.getSessionData({keys:["edit_senderAddrID"]},function(e){_=e.data.edit_senderAddrID}),ant.call("setTitle",{title:"编辑寄件人地址"})):"write"==d?("a106.b2102",i="a106.b2102.c4593.d7100",n="a106.b2102.c4593.d7101",o="a106.b2102.c4593.d7102",s="a106.b2102.c4593.d7104",c="a106.b2102.c4593.d7105",r="a106.b2102.c4594.d7106",e("body").attr("data-aspm","b2102"),e(".sender_name").attr("data-spmv",i),e(".sender_phone").attr("data-spmv",n),e(".sender_address").attr("data-spmv",o),e(".sender_dizhi").attr("data-spmv",s),e("#defaultClick").attr("data-spmv",c),e(".am-button").attr("data-spmv",r),ant.call("setTitle",{title:"填写寄件人地址"}),e(".defaultSelect").show()):("a106.b2122",i="a106.b2122.c4681.d7296",n="a106.b2122.c4681.d7297",o="a106.b2122.c4681.d7298",s="a106.b2122.c4681.d7300",r="a106.b2122.c4682.d7301",e("body").attr("data-aspm","b2122"),e(".sender_name").attr("data-spmv",i),e(".sender_phone").attr("data-spmv",n),e(".sender_address").attr("data-spmv",o),e(".sender_dizhi").attr("data-spmv",s),e(".am-button").attr("data-spmv",r),ant.call("setTitle",{title:"添加寄件人地址"})),ant.on("resume",function(t){ant.getSessionData({keys:["autocomplete_address"]},function(t){var a=t.data.autocomplete_address;if(""!==a){var d=emojione.toShort(a);e(".sender_dizhi").val(d.replace(/\:[a-z0-9_]+\:/g,"")),e("textarea[autoHeight]").autoHeight()}})}),ant.setSessionData({data:{autocomplete_address:"",autocomplete_cityName:""}}),e.fn.autoHeight=function(){function t(e){e.style.height="auto",e.scrollTop=0,e.style.height=e.scrollHeight+"px"}this.each(function(){t(this),e(this).on("input",function(){t(this)})})},e("textarea[autoHeight]").autoHeight();var v=!1;e(".sender_name").bind("compositionstart",function(){console.log("compositionstart"),v=!0}),e(".sender_name").bind("compositionend",function(){v=!1}),e(".sender_name").bind("input",function(){if(console.log("sendname  input"+e(this).val()),!v){var t=emojione.toShort(e(this).val());if(/\:[a-z0-9_]+\:/g.test(t)&&(t=t.replace(/\:[a-z0-9_]+\:/g,""),e(this).val(t)),e(this).val().length>=21){var a=e(this).val().slice(0,20);e(this).val(a)}}}),e(".sender_phone").bind("input",function(){var t=e(this).val();t=processPhoneNum(t),e(this).val(t)}),e(".sender_dizhi").bind("click",function(){if(""===l)return void toast({text:"请先选择地区"});var t=e(".sender_dizhi").val();ant.setSessionData({data:{autocomplete_address:t,autocomplete_cityName:l}}),pushWindow("autocomplete.html",!1)}),e(".sender_name").on("click",function(){"edit"==d?BizLog.call("info",{spmId:i,actionId:"clicked",params:{AddrID:_}}):BizLog.call("info",{spmId:i,actionId:"clicked"})}),e(".sender_phone").on("click",function(){"edit"==d?BizLog.call("info",{spmId:n,actionId:"clicked",params:{AddrID:_}}):BizLog.call("info",{spmId:n,actionId:"clicked"})}),e(".sender_dizhi").on("click",function(){"edit"==d?BizLog.call("info",{spmId:s,actionId:"clicked",params:{AddrID:_}}):BizLog.call("info",{spmId:s,actionId:"clicked"})}),function(){var t=e("#select_contact"),a=e("#show_contact"),i=e("#contact_province_code"),n=e("#contact_city_code"),s=e("#contact_district_code");e(".choise_addressstitle").click(function(){"edit"==d?BizLog.call("info",{spmId:o,actionId:"clicked",params:{AddrID:_}}):BizLog.call("info",{spmId:o,actionId:"clicked"}),e("body").on("touchmove",function(e){e.preventDefault()},!1),e(".sender_name").blur(),e(".sender_phone").blur(),e(".sender_dizhi").blur(),t.find("input").focusin(function(){this.blur()});var c=(a.attr("data-city-code"),a.attr("data-city-name"),a.attr("data-province-code")),r=a.attr("data-city-code"),v=a.attr("data-district-code");new IosSelect(3,[iosProvinces,iosCitys,iosCountys],{itemHeight:35,headerHeight:42,cssUnit:"px",relation:[1,1,0,0],oneLevelId:c,twoLevelId:r,threeLevelId:v,callback:function(e,t,d){i.val(e.id),i.attr("data-province-name",e.value),s.val(d.id),s.attr("data-district-name",d.value),n.val(t.id),n.attr("data-city-name",t.value),a.attr("data-province-code",e.id),a.attr("data-city-code",t.id),a.attr("data-district-code",d.id);var o=e.value,c=t.value;l=c;var r=d.value;console.log("provinceName "+o+"cityName "+c+"districtName "+r+"selectThreeObj.id "+d.id);var _=subAreaString(o,c,r);a.val(_)}})})}(),"write"==d&&(e("#defaultCheckBox").find("span").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/default-select.png)"}),e("#defaultClick").click(function(){"edit"==d?BizLog.call("info",{spmId:c,actionId:"clicked",params:{AddrID:_}}):BizLog.call("info",{spmId:c,actionId:"clicked"});var t=e("#defaultCheckBox");t.hasClass("defaultSelect")?(t.toggleClass("defaultSelect"),t.find("span").css({"background-image":"url(https://kuaidi-dev.oss-cn-hangzhou.aliyuncs.com/mobile/default-noSelect.png)"})):(t.toggleClass("defaultSelect"),t.find("span").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/default-select.png)"}))}));var m=!1;e(".am-button").click(function(){if("edit"==d?BizLog.call("info",{spmId:r,actionId:"clicked",params:{AddrID:_}}):BizLog.call("info",{spmId:r,actionId:"clicked"}),!m&&a()){m=!0;e(".am-button").html('<i class="icon" aria-hidden="true"></i>正在保存...'),setTimeout(function(){m=!1,e(".am-button").html("完成")},8e3);var t=e(".sender_name").attr("data-sendID");if("write"==d){var i=cellPhoneHide(e(".sender_phone").val());if(ant.setSessionData({data:{sendName:nameHide(emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,"")),real_sendName:emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,""),sendNumber:i,real_sendNumber:e(".sender_phone").val(),sendProvinceCode:e("#show_contact").attr("data-province-code"),sendCityCode:e("#show_contact").attr("data-city-code"),sendAreaCode:e("#show_contact").attr("data-district-code"),sendStreet:getAreaNameByCode(e("#show_contact").attr("data-district-code")).replace(/\s/g,""),sendAddress:emojione.toShort(e(".sender_dizhi").val()).replace(/\:[a-z0-9_]+\:/g,"")}}),!e("#defaultCheckBox").hasClass("defaultSelect"))return emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,"")==u&&e(".sender_phone").val()==p&&e("#show_contact").attr("data-district-code")==g&&e(".sender_dizhi").val()==f||ant.setSessionData({data:{senderAddrID:-1}}),void ant.popWindow();if("-1"!=t&&emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,"")==u&&e(".sender_phone").val()==p&&e("#show_contact").attr("data-district-code")==g&&e(".sender_dizhi").val()==f)return ant.popWindow(),void console.log("write  data not change");t=!1}if(t)var n={id:t,name:emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,""),mobile:e(".sender_phone").val(),provinceCode:e("#show_contact").attr("data-province-code"),cityCode:e("#show_contact").attr("data-city-code"),districtCode:e("#show_contact").attr("data-district-code"),street:"",address:emojione.toShort(e(".sender_dizhi").val()).replace(/\:[a-z0-9_]+\:/g,"")},o=jUrl+"/ep/sender/edit";else var n={name:emojione.toShort(e(".sender_name").val()).replace(/\:[a-z0-9_]+\:/g,""),mobile:e(".sender_phone").val(),provinceCode:e("#show_contact").attr("data-province-code"),cityCode:e("#show_contact").attr("data-city-code"),districtCode:e("#show_contact").attr("data-district-code"),street:"",address:emojione.toShort(e(".sender_dizhi").val()).replace(/\:[a-z0-9_]+\:/g,"")},o=jUrl+"/ep/sender/add";e.axs(o,n,function(e){if(e.meta.success){if(0==y&&!t||"write"==d)if(y++,ant.setSessionData({data:{senderCount:y}}),1!=y||t||-1!=b){var a=cellPhoneHide(e.result.mobile),i=a,n=nameHide(e.result.name),o=getAreaNameByCode(e.result.districtCode).replace(/\s/g,"");ant.setSessionData({data:{senderAddrID:e.result.id,sendName:n,sendNumber:i,real_sendName:e.result.name,real_sendNumber:e.result.mobile,sendProvinceCode:e.result.provinceCode,sendCityCode:e.result.cityCode,sendAreaCode:e.result.districtCode,sendStreet:o,sendAddress:e.result.address}})}else;ant.popWindow()}})}});var u,p,h,g,f,b,y=0;ant.getSessionData({keys:["edit_senderAddrID","edit_sendName","edit_sendNumber","edit_sendAddress","edit_sendProvinceCode","edit_sendCityCode","edit_sendAreaCode","senderCount","senderAddrID"]},function(a){if(b=a.data.senderAddrID,a.data.senderCount&&(y=a.data.senderCount),!a.data.edit_senderAddrID||"edit"!=d&&"write"!=d)t();else{var i=a.data.edit_senderAddrID;u=a.data.edit_sendName||"",p=a.data.edit_sendNumber||"",f=a.data.edit_sendAddress||"";var n=a.data.edit_sendProvinceCode||"",o=a.data.edit_sendCityCode||"";g=a.data.edit_sendAreaCode||"",e(".sender_name").attr("data-sendID",i),e(".sender_name").val(u),e(".sender_phone").val(p),e(".sender_dizhi").val(f),e("textarea[autoHeight]").autoHeight();for(var s=(getUrlParam("sRid"),getUrlParam("selectSUid"),0);s<iosProvinces.length;s++)n==iosProvinces[s].id&&(e("#contact_province_code").val(iosProvinces[s].id),e("#contact_province_code").attr("data-province-name",iosProvinces[s].value));for(var s=0;s<iosCitys.length;s++)o==iosCitys[s].id&&(e("#contact_city_code").val(iosCitys[s].id),e("#contact_city_code").attr("data-city-name",iosCitys[s].value));for(var s=0;s<iosCountys.length;s++)g==iosCountys[s].id&&(e("#contact_district_code").val(iosCountys[s].id),e("#contact_district_code").attr("data-district-name",iosCountys[s].value));var c=e("#contact_province_code").attr("data-province-name"),r=e("#contact_city_code").attr("data-city-name");l=r;var _=e("#contact_district_code").attr("data-district-name");h=subAreaString(c,r,_),e(".sender_address").val(h),e(".sender_address").attr("data-province-code",e("#contact_province_code").val()),e(".sender_address").attr("data-city-code",e("#contact_city_code").val()),e(".sender_address").attr("data-district-code",e("#contact_district_code").val())}})});