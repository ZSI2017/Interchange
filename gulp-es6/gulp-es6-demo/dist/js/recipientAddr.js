"use strict";Zepto(function(e){function t(){e(".input_tab").on("input propertychange",function(){});var t=!1;e(".recipient_name").bind("compositionstart",function(){t=!0}),e(".recipient_name").bind("compositionend",function(){t=!1}),e(".recipient_name").bind("input",function(){if(!t){var a=emojione.toShort(e(this).val());if(/\:[a-z0-9_]+\:/g.test(a)&&(a=a.replace(/\:[a-z0-9_]+\:/g,""),e(this).val(a)),e(this).val().length>=21){var i=e(this).val().slice(0,20);e(this).val(i)}}}),e(".mobile_numbers").bind("input",function(){var t=e(this).val();t=processPhoneNum(t),e(this).val(t)}),e(".recipient_dizhi").bind("click",function(){if(""===u)return void toast({text:"请先选择地区"});var t=e(".recipient_dizhi").val();ant.setSessionData({data:{autocomplete_address:t,autocomplete_cityName:u}}),pushWindow("autocomplete.html",!1)})}function a(){"write"==d&&(e("#defaultCheckBox").find("span").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/default-select.png)"}),e("#defaultClick").click(function(){BizLog.call("info",{spmId:m,actionId:"clicked"});var t=e("#defaultCheckBox");t.hasClass("defaultSelect")?(t.toggleClass("defaultSelect"),t.find("span").css({"background-image":"url(https://kuaidi-dev.oss-cn-hangzhou.aliyuncs.com/mobile/default-noSelect.png)"})):(t.toggleClass("defaultSelect"),t.find("span").css({"background-image":"url(https://expressprod.oss-cn-hangzhou.aliyuncs.com/mobile/img/default-select.png)"}))}))}function i(){e("#getLocation").on("click",function(){"edit"==d?BizLog.call("info",{spmId:n,actionId:"clicked",params:{AddrID:v}}):BizLog.call("info",{spmId:n,actionId:"clicked"}),ant.call("contact",function(t){if(t.errorCode&&10==t.errorCode)toast({text:"无通讯录访问权限\n请设置允许app访问通讯录"});else{e(".recipient_name").val(JSON.parse(JSON.stringify(t.name)));var a=JSON.parse(JSON.stringify(t.mobile)).replace(/[^0-9]/gi,"");0==a.indexOf("86")&&(a=a.slice(2,a.length));var i=a.length-15;i>0&&(a=a.substring(i));/^\d{1,15}$/.test(a),e(".mobile_numbers").val(a)}})});var t=e("#select_contact_re"),a=e("#show_contact_re"),i=e("#contact_province_code_re"),r=e("#contact_city_code_re"),c=e("#contact_district_code_re");e(".choise_addressstitle").click(function(){if(!k){e(".recipient_name").blur(),e(".mobile_numbers").blur(),e(".recipient_dizhi").blur(),t.find("input").focusin(function(){this.blur()}),e("body").on("touchmove",function(e){e.preventDefault()},!1);var d=(a.attr("data-city-code-re"),a.attr("data-city-name-re"),a.attr("data-province-code-re")),o=a.attr("data-city-code-re"),n=a.attr("data-district-code-re");new IosSelect(3,[iosProvinces,iosCitys,iosCountys],{title:"",itemHeight:35,headerHeight:42,cssUnit:"px",relation:[1,1,0,0],oneLevelId:d,twoLevelId:o,threeLevelId:n,callback:function(e,t,d){i.val(e.id),i.attr("data-province-name-re",e.value),c.val(d.id),c.attr("data-district-name-re",d.value),r.val(t.id),r.attr("data-city-name-re",t.value),a.attr("data-province-code-re",e.id),a.attr("data-city-code-re",t.id),a.attr("data-district-code-re",d.id);var o=e.value,n=t.value;u=n;var s=d.value,l=subAreaString(o,n,s,"true");a.val(l)}})}})}function r(){e(".am-button-Rec").click(function(){if("edit"==d?BizLog.call("info",{spmId:_,actionId:"clicked",params:{AddrID:v}}):BizLog.call("info",{spmId:_,actionId:"clicked"}),!z&&c()){z=!0;e(".am-button-Rec").html('<i class="icon" aria-hidden="true"></i>正在保存...'),setTimeout(function(){z=!1,e(".am-button-Rec").html("完成")},8e3);var t,a,i=e("#reciptiens_id").val(),r=emojione.toShort(e(".recipient_name").val()).replace(/\:[a-z0-9_]+\:/g,""),o=e(".mobile_numbers").val(),n=e("#contact_province_code_re").val(),s=e("#contact_city_code_re").val(),l=e("#contact_district_code_re").val(),p=emojione.toShort(e(".recipient_dizhi").val()).replace(/\:[a-z0-9_]+\:/g,"");if("write"==d){var m=cellPhoneHide(o);if(ant.setSessionData({data:{recName:nameHide(r),recNumber:m,real_recNumber:o,real_recName:r,recProvinceCode:n,recCityCode:s,recAreaCode:l,recStreet:getAreaNameByCode(l).replace(/\s/g,""),recAddress:p}}),!e("#defaultCheckBox").hasClass("defaultSelect"))return r==h&&o==f&&p==g&&parseFloat(C)==parseFloat(l)||ant.setSessionData({data:{reciptiensAddrID:-1}}),void ant.popWindow();if("-1"!=i&&r==h&&o==f&&p==g&&parseFloat(C)==parseFloat(l))return ant.popWindow(),void console.log("write  data not change");i=!1}i?(t={id:i,name:r,mobile:o,provinceCode:n,cityCode:s,districtCode:l,street:"",address:p},a=jUrl+"/ep/receiver/edit"):(t={name:r,mobile:o,provinceCode:n,cityCode:s,districtCode:l,street:"",address:p},a=jUrl+"/ep/receiver/add"),e.axs(a,t,function(e){if(e.meta.success){if(ant.setSessionData({data:{edit_reciptiensAddrID:"",edit_recName:"",edit_recNumber:"",edit_recProvinceCode:"",edit_recCityCode:"",edit_recAreaCode:"",edit_recStreet:"",edit_recAddress:""}}),0==I&&!i||"write"==d)if(I++,ant.setSessionData({data:{receiverCount:I}}),1!=I||i||-1!=y){var t=cellPhoneHide(e.result.mobile),a=nameHide(e.result.name),r=getAreaNameByCode(e.result.districtCode).replace(/\s/g,"");ant.setSessionData({data:{reciptiensAddrID:e.result.id,recName:a,recNumber:t,real_recNumber:e.result.mobile,real_recName:e.result.name,recProvinceCode:e.result.provinceCode,recCityCode:e.result.cityCode,recAreaCode:e.result.districtCode,recStreet:r,recAddress:e.result.address}})}else;ant.popWindow()}})}})}function c(){return""==e(".recipient_name").val()||0===e(".recipient_name").val().trim().length||e(".sender_name").val().length>=21?(toast({text:"姓名不能为空"}),!1):""!=e(".mobile_numbers").val()&&isCorrectPhoneNum(e(".mobile_numbers").val())?""==e(".recipient_address").val()||" "==e(".recipient_address").val()?void toast({text:"请选择地区"}):!(""==e(".recipient_dizhi").val()||0===e(".recipient_dizhi").val().trim().length||e(".recipient_dizhi").val().length>=51)||(toast({text:"详细地址不能为空"}),!1):(toast({text:"请输入正确的手机号或座机号"}),!1)}FastClick.attach(document.body),console.log("edit"==getUrlParam("edit"));var d=getUrlParam("edit"),o="",n="",s="",l="",p="",m="",u="",_="",v="";"edit"==d?("a106.b2128",o="a106.b2128.c4693.d7326",n="a106.b2128.c4693.d7327",s="a106.b2128.c4693.d7328",l="a106.b2128.c4693.d7329",p="a106.b2128.c4693.d7330",_="a106.b2128.c4692.d7325",e("body").attr("data-aspm","b2128"),e(".sender_name").attr("data-spmv",o),e(".get_location").attr("data-spmv",n),e(".sender_phone").attr("data-spmv",s),e(".sender_address").attr("data-spmv",l),e(".sender_dizhi").attr("data-spmv",p),e(".am-button").attr("data-spmv",_),ant.getSessionData({keys:["edit_reciptiensAddrID"]},function(e){v=e.data.edit_reciptiensAddrID}),ant.call("setTitle",{title:"编辑收件人地址"})):"write"==d?("a106.b2126",o="a106.b2126.c4687.d7311",n="a106.b2126.c4687.d7312",s="a106.b2126.c4687.d7313",l="a106.b2126.c4687.d7314",p="a106.b2126.c4687.d7315",m="a106.b2126.c4687.d7316",_="a106.b2126.c4688.d7317",e("body").attr("data-aspm","b2126"),e(".sender_name").attr("data-spmv",o),e(".get_location").attr("data-spmv",n),e(".sender_phone").attr("data-spmv",s),e(".sender_address").attr("data-spmv",l),e(".sender_dizhi").attr("data-spmv",p),e("#defaultClick").attr("data-spmv",m),e(".am-button").attr("data-spmv",_),ant.call("setTitle",{title:"填写收件人地址"}),e(".defaultSelect").show()):("a106.b2123",o="a106.b2123.c4683.d7303",n="a106.b2123.c4683.d7304",s="a106.b2123.c4683.d7305",l="a106.b2123.c4683.d7306",p="a106.b2123.c4683.d7307",_="a106.b2123.c4684.d7308",e("body").attr("data-aspm","b2123"),e(".sender_name").attr("data-spmv",o),e(".get_location").attr("data-spmv",n),e(".sender_phone").attr("data-spmv",s),e(".sender_address").attr("data-spmv",l),e(".sender_dizhi").attr("data-spmv",p),e(".am-button").attr("data-spmv",_),ant.call("setTitle",{title:"添加收件人地址"})),ant.on("resume",function(t){ant.getSessionData({keys:["autocomplete_address"]},function(t){var a=t.data.autocomplete_address;if(""!==a){var i=emojione.toShort(a);e(".recipient_dizhi").val(i.replace(/\:[a-z0-9_]+\:/g,"")),e("textarea[autoHeight]").autoHeight()}})}),ant.setSessionData({data:{autocomplete_address:"",autocomplete_cityName:""}}),e.fn.autoHeight=function(){function t(e){e.style.height="auto",e.scrollTop=0,e.style.height=e.scrollHeight+"px"}this.each(function(){t(this),e(this).on("input",function(){t(this)})})},function(){ant.getSessionData({keys:["edit_reciptiensAddrID","edit_recName","edit_recNumber","edit_recProvinceCode","edit_recCityCode","edit_recAreaCode","edit_recStreet","edit_recAddress","receiverCount","reciptiensAddrID"]},function(c){y=c.data.reciptiensAddrID;var o=c.data.edit_reciptiensAddrID||"";h=c.data.edit_recName||"",f=c.data.edit_recNumber||"",g=c.data.edit_recAddress||"";var n=c.data.edit_recProvinceCode||"",s=c.data.edit_recCityCode||"";if(C=c.data.edit_recAreaCode||"",c.data.edit_recStreet,I=c.data.receiverCount,o&&("edit"==d||"write"==d)){e("#reciptiens_id").val(o),e(".recipient_name").val(h),e(".mobile_numbers").val(f),e(".sender_dizhi").val(g),e("textarea[autoHeight]").autoHeight();for(var l=0;l<iosProvinces.length;l++)n==iosProvinces[l].id&&(e("#contact_province_code_re").val(iosProvinces[l].id),e("#contact_province_code_re").attr("data-province-name-re",iosProvinces[l].value));for(var l=0;l<iosCitys.length;l++)s==iosCitys[l].id&&(e("#contact_city_code_re").val(iosCitys[l].id),e("#contact_city_code_re").attr("data-city-name-re",iosCitys[l].value));for(var l=0;l<iosCountys.length;l++)C==iosCountys[l].id&&(e("#contact_district_code_re").val(iosCountys[l].id),e("#contact_district_code_re").attr("data-district-name-re",iosCountys[l].value));var p=e("#contact_province_code_re").attr("data-province-name-re"),m=e("#contact_city_code_re").attr("data-city-name-re");u=m;var _=e("#contact_district_code_re").attr("data-district-name-re");b=subAreaString(p,m,_,"true"),e(".recipient_address").val(b),e(".recipient_address").attr("data-province-code-re",e("#contact_province_code_re").val()),e(".recipient_address").attr("data-city-code-re",e("#contact_city_code_re").val()),e(".recipient_address").attr("data-district-code-re",e("#contact_district_code_re").val())}e("textarea[autoHeight]").autoHeight(),i(),t(),r(),a()})}();var h,f,b,g,C,y,I=0,k=!1;e(".sender_name").on("click",function(){"edit"==d?BizLog.call("info",{spmId:o,actionId:"clicked",params:{AddrID:v}}):BizLog.call("info",{spmId:o,actionId:"clicked"})}),e(".sender_phone").on("click",function(){"edit"==d?BizLog.call("info",{spmId:s,actionId:"clicked",params:{AddrID:v}}):BizLog.call("info",{spmId:s,actionId:"clicked"})}),e(".recipient_address").on("click",function(){"edit"==d?BizLog.call("info",{spmId:l,actionId:"clicked",params:{AddrID:v}}):BizLog.call("info",{spmId:l,actionId:"clicked"})}),e(".recipient_dizhi").on("click",function(){"edit"==d?BizLog.call("info",{spmId:p,actionId:"clicked",params:{AddrID:v}}):BizLog.call("info",{spmId:p,actionId:"clicked"})});var z=!1});